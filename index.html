<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Texas Region — RP Strategic Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo } = React;
    const {
      BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip,
      ComposedChart, Line, Area, ResponsiveContainer, Cell,
      ReferenceLine, PieChart, Pie, ScatterChart, Scatter, ZAxis,
    } = Recharts;



// ── Theme ────────────────────────────────────────────────────────
const C = {
  bg: "#f8f9fa",
  card: "#ffffff",
  border: "#dee2e6",
  text: "#212529",
  muted: "#78716c",
  actual: "#1864ab",
  actualLight: "#a5d8ff",
  budget: "#adb5bd",
  budgetFade: "#dee2e6",
  green: "#2b8a3e",
  greenBg: "#d3f9d8",
  greenSoft: "#40c057",
  red: "#c92a2a",
  redBg: "#ffe3e3",
  amber: "#e67700",
  amberBg: "#fff3bf",
  purple: "#7048e8",
  teal: "#0c8599",
};

const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const ACTUAL_MONTHS = 6; // Through June
const font = "'Söhne', 'Helvetica Neue', system-ui, sans-serif";
const mono = "'SF Mono', 'Consolas', monospace";

// ── Fabricated Data (with intentional gaps & lumpiness) ──────────
// The story: Comm loans behind due to Q1 pipeline delays, but big fundings
// expected Q3. Deposits lagging — need to push. TM revenue soft. Consumer on track.

const monthly = MONTHS.map((m, i) => {
  const isActual = i < ACTUAL_MONTHS;
  // Commercial Loans — actual came in lumpy, behind early, big May funding
  const commAvgBal_bgt = [2410,2445,2470,2500,2535,2560,2590,2620,2650,2680,2710,2740];
  const commAvgBal_act = [2380,2395,2410,2420,2510,2540]; // behind then May bump
  const commYield_bgt = [7.12,7.15,7.15,7.20,7.22,7.25,7.28,7.30,7.32,7.35,7.38,7.40];
  const commYield_act = [7.08,7.10,7.05,7.12,7.18,7.22];
  const commII_bgt = [14.3,14.6,14.7,15.0,15.3,15.5,15.7,15.9,16.2,16.4,16.7,16.9];
  const commII_act = [14.0,14.1,14.1,14.4,15.1,15.3]; // behind early, catching up

  // Consumer — tracking well, slightly ahead
  const consII_bgt = [4.3,4.3,4.4,4.4,4.5,4.5,4.6,4.6,4.7,4.7,4.8,4.8];
  const consII_act = [4.4,4.4,4.5,4.5,4.6,4.7]; // slightly ahead

  // Deposits — clearly behind, cost higher than planned
  const depAvgBal_bgt = [3840,3870,3900,3930,3960,3990,4020,4050,4080,4110,4140,4170];
  const depAvgBal_act = [3780,3790,3810,3830,3850,3870]; // 100-120M behind
  const depCost_bgt = [3.44,3.46,3.45,3.44,3.42,3.40,3.38,3.36,3.34,3.32,3.30,3.28];
  const depCost_act = [3.52,3.55,3.54,3.50,3.48,3.46]; // higher than budget
  const depIE_bgt = [11.0,11.2,11.2,11.3,11.3,11.3,11.3,11.3,11.3,11.4,11.4,11.4];
  const depIE_act = [11.1,11.3,11.2,11.2,11.2,11.2];

  // Allocations
  const allocNII_bgt = [2.1,2.1,2.2,2.2,2.2,2.3,2.3,2.3,2.4,2.4,2.4,2.5];
  const allocNII_act = [2.1,2.2,2.2,2.3,2.2,2.3];

  // Fee Income — TM and PCARD soft, Service Charges OK
  const tm_bgt =  [0.8,0.9,0.9,0.9,1.0,1.0,1.0,1.0,1.1,1.1,1.1,1.2];
  const tm_act =  [0.6,0.7,0.7,0.8,0.8,0.8]; // notably behind
  const pc_bgt =  [0.3,0.3,0.3,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.5,0.5];
  const pc_act =  [0.2,0.3,0.3,0.3,0.3,0.3]; // slightly behind
  const merch_bgt = [0.2,0.2,0.3,0.3,0.3,0.3,0.3,0.3,0.3,0.3,0.3,0.4];
  const merch_act = [0.2,0.2,0.2,0.3,0.3,0.3];
  const svc_bgt = [0.5,0.5,0.5,0.5,0.6,0.6,0.6,0.6,0.6,0.6,0.7,0.7];
  const svc_act = [0.5,0.5,0.6,0.5,0.6,0.6]; // on track
  const oth_bgt = [0.4,0.3,0.4,0.4,0.4,0.5,0.4,0.5,0.5,0.5,0.5,0.6];
  const oth_act = [0.4,0.4,0.4,0.4,0.4,0.5];

  const commII = isActual ? commII_act[i] : commII_bgt[i];
  const consII = isActual ? consII_act[i] : consII_bgt[i];
  const depIE = isActual ? depIE_act[i] : depIE_bgt[i];
  const allocNII = isActual ? allocNII_act[i] : allocNII_bgt[i];
  const rawNII = commII + consII - depIE;
  const flNII = rawNII - allocNII;

  const tm = isActual ? tm_act[i] : tm_bgt[i];
  const pc = isActual ? pc_act[i] : pc_bgt[i];
  const merch = isActual ? merch_act[i] : merch_bgt[i];
  const svc = isActual ? svc_act[i] : svc_bgt[i];
  const oth = isActual ? oth_act[i] : oth_bgt[i];
  const flNIOI = tm + pc + merch + svc + oth;
  const flRevenue = flNII + flNIOI;

  // Budget versions for comparison
  const bgtRawNII = commII_bgt[i] + consII_bgt[i] - depIE_bgt[i];
  const bgtFLNII = bgtRawNII - allocNII_bgt[i];
  const bgtFLNIOI = tm_bgt[i] + pc_bgt[i] + merch_bgt[i] + svc_bgt[i] + oth_bgt[i];
  const bgtFLRevenue = bgtFLNII + bgtFLNIOI;

  return {
    month: m, isActual,
    commII, commII_bgt: commII_bgt[i],
    consII, consII_bgt: consII_bgt[i],
    depIE, depIE_bgt: depIE_bgt[i],
    commAvgBal: isActual ? commAvgBal_act[i] : commAvgBal_bgt[i],
    commAvgBal_bgt: commAvgBal_bgt[i],
    depAvgBal: isActual ? depAvgBal_act[i] : depAvgBal_bgt[i],
    depAvgBal_bgt: depAvgBal_bgt[i],
    depCost: isActual ? depCost_act[i] : depCost_bgt[i],
    depCost_bgt: depCost_bgt[i],
    allocNII, flNII, flNIOI, flRevenue,
    tm, tm_bgt: tm_bgt[i],
    pc, pc_bgt: pc_bgt[i],
    merch, merch_bgt: merch_bgt[i],
    svc, svc_bgt: svc_bgt[i],
    oth, oth_bgt: oth_bgt[i],
    bgtFLNII, bgtFLNIOI, bgtFLRevenue,
  };
});

// ── Helpers ──────────────────────────────────────────────────────
const sum = (arr, key) => arr.reduce((s, d) => s + (d[key] || 0), 0);
const actuals = monthly.filter(d => d.isActual);
const remaining = monthly.filter(d => !d.isActual);

const Tip = ({ active, payload, label }) => {
  if (!active || !payload) return null;
  return (
    <div style={{
      background: "#fff", border: `1px solid ${C.border}`, borderRadius: 6,
      padding: "10px 14px", fontSize: 11, fontFamily: mono,
      color: C.text, boxShadow: "0 4px 12px rgba(0,0,0,0.08)",
    }}>
      <div style={{ fontWeight: 700, marginBottom: 5, color: C.actual }}>{label}</div>
      {payload.filter(p => p.value != null && p.dataKey !== "invisible").map((p, i) => (
        <div key={i} style={{ display: "flex", alignItems: "center", gap: 7, marginBottom: 2 }}>
          <span style={{ width: 7, height: 7, borderRadius: 2, background: p.color || p.fill, display: "inline-block" }} />
          <span style={{ color: C.muted }}>{p.name}:</span>
          <span style={{ fontWeight: 600 }}>
            {typeof p.value === "number" ? (Math.abs(p.value) >= 100 ? `$${p.value.toLocaleString()}M` : `$${p.value.toFixed(2)}M`) : p.value}
          </span>
        </div>
      ))}
    </div>
  );
};

const Dot = ({ color, label, dashed, striped }) => (
  <span style={{ display: "inline-flex", alignItems: "center", gap: 5, marginRight: 12, fontSize: 10, color: C.muted, fontFamily: mono }}>
    {dashed
      ? <span style={{ width: 14, height: 0, borderTop: `2.5px dashed ${color}`, display: "inline-block" }} />
      : <span style={{ width: 8, height: 8, borderRadius: 2, background: color, display: "inline-block", opacity: striped ? 0.35 : 1 }} />
    }
    {label}
  </span>
);

const cardStyle = {
  background: C.card,
  border: `1px solid ${C.border}`,
  borderRadius: 8,
  padding: "18px 16px 10px",
  boxShadow: "0 1px 2px rgba(0,0,0,0.04)",
};

// ══════════════════════════════════════════════════════════════════
// CHART 1 — THE SCORECARD
// "Where are we?" at a glance. Red/yellow/green for each line.
// ══════════════════════════════════════════════════════════════════
const Scorecard = () => {
  const lines = [
    { label: "FL Revenue", ytdAct: sum(actuals, "flRevenue"), ytdBgt: sum(actuals, "bgtFLRevenue"), fyBgt: sum(monthly, "bgtFLRevenue") },
    { label: "FL NII", ytdAct: sum(actuals, "flNII"), ytdBgt: sum(actuals, "bgtFLNII"), fyBgt: sum(monthly, "bgtFLNII") },
    { label: "FL NIOI", ytdAct: sum(actuals, "flNIOI"), ytdBgt: sum(actuals, "bgtFLNIOI"), fyBgt: sum(monthly, "bgtFLNIOI") },
    { label: "Comm Loan II", ytdAct: sum(actuals, "commII"), ytdBgt: sum(actuals, "commII_bgt"), fyBgt: sum(monthly, "commII_bgt") },
    { label: "Consumer II", ytdAct: sum(actuals, "consII"), ytdBgt: sum(actuals, "consII_bgt"), fyBgt: sum(monthly, "consII_bgt") },
    { label: "Deposit IE", ytdAct: sum(actuals, "depIE"), ytdBgt: sum(actuals, "depIE_bgt"), fyBgt: sum(monthly, "depIE_bgt"), invert: true },
    { label: "Treasury Mgmt", ytdAct: sum(actuals, "tm"), ytdBgt: sum(actuals, "tm_bgt"), fyBgt: sum(monthly, "tm_bgt") },
    { label: "PCARD", ytdAct: sum(actuals, "pc"), ytdBgt: sum(actuals, "pc_bgt"), fyBgt: sum(monthly, "pc_bgt") },
    { label: "Service Charges", ytdAct: sum(actuals, "svc"), ytdBgt: sum(actuals, "svc_bgt"), fyBgt: sum(monthly, "svc_bgt") },
  ].map(d => {
    const variance = d.ytdAct - d.ytdBgt;
    const variancePct = (variance / d.ytdBgt) * 100;
    // For deposit IE, being under budget is good (invert)
    const effectiveVar = d.invert ? -variancePct : variancePct;
    const status = effectiveVar >= -0.5 ? "green" : effectiveVar >= -3 ? "amber" : "red";
    const runRate = (d.ytdAct / ACTUAL_MONTHS) * 12;
    const impliedNeed = (d.fyBgt - d.ytdAct) / (12 - ACTUAL_MONTHS);
    const recentAvg = (actuals.slice(-3).reduce((s, x) => s + (x[Object.keys(x).find(k => {
      const map = { "FL Revenue": "flRevenue", "FL NII": "flNII", "FL NIOI": "flNIOI", "Comm Loan II": "commII", "Consumer II": "consII", "Deposit IE": "depIE", "Treasury Mgmt": "tm", "PCARD": "pc", "Service Charges": "svc" };
      return map[d.label] === k;
    })] || 0), 0)) / 3;
    return { ...d, variance, variancePct, effectiveVar, status, runRate, impliedNeed, recentAvg };
  });

  const statusColor = (s) => s === "green" ? C.green : s === "amber" ? C.amber : C.red;
  const statusBg = (s) => s === "green" ? C.greenBg : s === "amber" ? C.amberBg : C.redBg;
  const statusIcon = (s) => s === "green" ? "●" : s === "amber" ? "▲" : "▼";

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>①</span>YTD Scorecard — Where Are We?
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 14 }}>
        6 months actual vs 6 months budget • Variance to plan drives the signal
      </div>

      <div style={{ overflowX: "auto" }}>
        <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 11, fontFamily: mono }}>
          <thead>
            <tr style={{ borderBottom: `2px solid ${C.text}` }}>
              {["", "Line Item", "YTD Actual", "YTD Budget", "Variance", "Var %", "Run Rate", "Need/Mo"].map((h, i) => (
                <th key={i} style={{
                  textAlign: i <= 1 ? "left" : "right", padding: "6px 8px",
                  fontSize: 9, textTransform: "uppercase", letterSpacing: "0.06em",
                  color: C.muted, fontWeight: 600,
                }}>{h}</th>
              ))}
            </tr>
          </thead>
          <tbody>
            {lines.map((d, i) => (
              <tr key={i} style={{
                borderBottom: `1px solid ${C.border}`,
                background: d.status === "red" ? C.redBg + "44" : "transparent",
              }}>
                <td style={{ padding: "8px 6px", textAlign: "center" }}>
                  <span style={{
                    color: statusColor(d.status), fontSize: 11, fontWeight: 800,
                  }}>{statusIcon(d.status)}</span>
                </td>
                <td style={{ padding: "8px", fontWeight: 600, color: C.text }}>{d.label}</td>
                <td style={{ padding: "8px", textAlign: "right" }}>${d.ytdAct.toFixed(1)}M</td>
                <td style={{ padding: "8px", textAlign: "right", color: C.muted }}>${d.ytdBgt.toFixed(1)}M</td>
                <td style={{ padding: "8px", textAlign: "right", fontWeight: 700, color: statusColor(d.status) }}>
                  {d.variance >= 0 ? "+" : ""}{d.variance.toFixed(2)}M
                </td>
                <td style={{ padding: "8px", textAlign: "right" }}>
                  <span style={{
                    background: statusBg(d.status), color: statusColor(d.status),
                    padding: "2px 6px", borderRadius: 3, fontWeight: 700, fontSize: 10,
                  }}>
                    {d.effectiveVar >= 0 ? "+" : ""}{d.effectiveVar.toFixed(1)}%
                  </span>
                </td>
                <td style={{ padding: "8px", textAlign: "right", color: C.muted }}>${d.runRate.toFixed(1)}M</td>
                <td style={{ padding: "8px", textAlign: "right", color: C.muted }}>${d.impliedNeed.toFixed(2)}M</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 2 — THE GAP CHART
// Horizontal deviation bars. Sorted by $ gap. "Where to push."
// ══════════════════════════════════════════════════════════════════
const GapChart = () => {
  const gaps = [
    { line: "Treasury Mgmt", gap: sum(actuals, "tm") - sum(actuals, "tm_bgt") },
    { line: "Comm Loan II", gap: sum(actuals, "commII") - sum(actuals, "commII_bgt") },
    { line: "PCARD", gap: sum(actuals, "pc") - sum(actuals, "pc_bgt") },
    { line: "Deposit IE*", gap: -(sum(actuals, "depIE") - sum(actuals, "depIE_bgt")) }, // inverted
    { line: "Merchant Fees", gap: sum(actuals, "merch") - sum(actuals, "merch_bgt") },
    { line: "Consumer II", gap: sum(actuals, "consII") - sum(actuals, "consII_bgt") },
    { line: "Service Chg", gap: sum(actuals, "svc") - sum(actuals, "svc_bgt") },
    { line: "Other Fees", gap: sum(actuals, "oth") - sum(actuals, "oth_bgt") },
  ].sort((a, b) => a.gap - b.gap);

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>②</span>YTD Gap to Plan — Where to Push
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 14 }}>
        Sorted by largest shortfall • Red = behind plan, Green = ahead • *Deposit IE inverted (lower is better)
      </div>
      <ResponsiveContainer width="100%" height={280}>
        <BarChart data={gaps} layout="vertical" barCategoryGap="22%">
          <CartesianGrid strokeDasharray="3 3" stroke="#eee" horizontal={false} />
          <XAxis type="number" tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false}
            tickFormatter={v => `${v >= 0 ? "+" : ""}$${v.toFixed(1)}M`} domain={[-2.5, 2]} />
          <YAxis dataKey="line" type="category" tick={{ fill: C.text, fontSize: 11, fontWeight: 600 }} axisLine={false} tickLine={false} width={100} />
          <Tooltip content={<Tip />} />
          <ReferenceLine x={0} stroke={C.text} strokeWidth={1.5} />
          <Bar dataKey="gap" name="YTD Gap" radius={4} barSize={18}>
            {gaps.map((d, i) => <Cell key={i} fill={d.gap >= 0 ? C.green : C.red} opacity={0.75} />)}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 3 — CUMULATIVE REVENUE (refined #8)
// With "catch-up trajectory" showing what H2 needs to look like
// ══════════════════════════════════════════════════════════════════
const CumulativeRevenue = () => {
  let cumAct = 0, cumBgt = 0;
  const data = monthly.map((d, i) => {
    cumBgt += d.bgtFLRevenue;
    if (d.isActual) cumAct += d.flRevenue;
    const catchUp = !d.isActual ? cumAct + remaining.slice(0, i - ACTUAL_MONTHS + 1).reduce((s, x) => s + x.bgtFLRevenue, 0) + (sum(actuals, "bgtFLRevenue") - sum(actuals, "flRevenue")) / (12 - ACTUAL_MONTHS) * (i - ACTUAL_MONTHS + 1) : null;
    return {
      month: d.month, isActual: d.isActual,
      cumActual: d.isActual ? cumAct : null,
      cumBudget: cumBgt,
      runRateProj: !d.isActual ? cumAct + (cumAct / ACTUAL_MONTHS) * (i - ACTUAL_MONTHS + 1) : null,
      catchUpLine: catchUp,
    };
  });

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>③</span>Cumulative FL Revenue — The Gap & The Path
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 14 }}>
        Green area = what's banked • Gray = budget trajectory • Amber dashed = if current pace holds
      </div>
      <div style={{ marginBottom: 8 }}>
        <Dot color={C.green} label="Cum. Actual" />
        <Dot color={C.budget} label="Cum. Budget" />
        <Dot color={C.amber} label="Run Rate Proj." dashed />
      </div>
      <ResponsiveContainer width="100%" height={280}>
        <ComposedChart data={data}>
          <defs>
            <linearGradient id="cumActGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stopColor={C.green} stopOpacity={0.2} />
              <stop offset="100%" stopColor={C.green} stopOpacity={0.02} />
            </linearGradient>
          </defs>
          <CartesianGrid strokeDasharray="3 3" stroke="#eee" vertical={false} />
          <XAxis dataKey="month" tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} />
          <YAxis domain={[0, 115]} tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} tickFormatter={v => `$${v}M`} />
          <Tooltip content={<Tip />} />
          <ReferenceLine x="Jun" stroke={C.actual} strokeWidth={1} strokeDasharray="4 4" />
          <Area dataKey="cumBudget" name="Cum. Budget" fill="#f1f3f5" stroke={C.budget} strokeWidth={2} dot={false} />
          <Area dataKey="cumActual" name="Cum. Actual" fill="url(#cumActGrad)" stroke={C.green} strokeWidth={3}
            dot={{ r: 5, fill: C.green, strokeWidth: 0 }} connectNulls={false} />
          <Line dataKey="runRateProj" name="Run Rate Proj." stroke={C.amber} strokeWidth={2.5}
            strokeDasharray="8 4" dot={false} connectNulls={false} />
        </ComposedChart>
      </ResponsiveContainer>
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 4 — RUN RATE GAUGES (refined #7)
// Horizontal bars with "implied monthly need" marker
// ══════════════════════════════════════════════════════════════════
const RunRateGauges = () => {
  const lines = [
    { label: "FL Revenue", ytd: sum(actuals, "flRevenue"), fy: sum(monthly, "bgtFLRevenue") },
    { label: "FL NII", ytd: sum(actuals, "flNII"), fy: sum(monthly, "bgtFLNII") },
    { label: "FL NIOI", ytd: sum(actuals, "flNIOI"), fy: sum(monthly, "bgtFLNIOI") },
    { label: "Comm Loan II", ytd: sum(actuals, "commII"), fy: sum(monthly, "commII_bgt") },
    { label: "Consumer II", ytd: sum(actuals, "consII"), fy: sum(monthly, "consII_bgt") },
    { label: "Treasury Mgmt", ytd: sum(actuals, "tm"), fy: sum(monthly, "tm_bgt") },
  ].map(d => {
    const runRate = (d.ytd / ACTUAL_MONTHS) * 12;
    const pct = (runRate / d.fy) * 100;
    const impliedNeed = (d.fy - d.ytd) / (12 - ACTUAL_MONTHS);
    const ytdMonthlyAvg = d.ytd / ACTUAL_MONTHS;
    const stepUpPct = ((impliedNeed - ytdMonthlyAvg) / ytdMonthlyAvg) * 100;
    const onPace = pct >= 98;
    return { ...d, runRate, pct, impliedNeed, ytdMonthlyAvg, stepUpPct, onPace };
  });

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>④</span>Run Rate vs Plan — Pace Check
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 16 }}>
        How the annualized run rate compares to full year budget • Right column shows what H2 monthly avg needs to be
      </div>
      <div style={{ display: "flex", flexDirection: "column", gap: 14 }}>
        {lines.map((d, i) => (
          <div key={i}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "baseline", marginBottom: 5 }}>
              <span style={{ fontSize: 12, fontWeight: 700, color: C.text, fontFamily: font }}>{d.label}</span>
              <div style={{ display: "flex", gap: 12, alignItems: "baseline" }}>
                <span style={{ fontSize: 10, color: C.muted, fontFamily: mono }}>
                  Avg/mo: <strong>${d.ytdMonthlyAvg.toFixed(2)}M</strong>
                </span>
                <span style={{ fontSize: 10, fontFamily: mono, color: C.muted }}>→</span>
                <span style={{ fontSize: 10, fontFamily: mono, fontWeight: 700, color: d.stepUpPct > 2 ? C.red : C.green }}>
                  Need: ${d.impliedNeed.toFixed(2)}M/mo
                  {d.stepUpPct > 2 && <span style={{ marginLeft: 4, fontSize: 9, background: C.redBg, padding: "1px 5px", borderRadius: 3 }}>
                    +{d.stepUpPct.toFixed(0)}% step-up
                  </span>}
                  {d.stepUpPct <= 2 && d.stepUpPct >= -2 && <span style={{ marginLeft: 4, fontSize: 9, background: C.amberBg, padding: "1px 5px", borderRadius: 3 }}>
                    hold pace
                  </span>}
                  {d.stepUpPct < -2 && <span style={{ marginLeft: 4, fontSize: 9, background: C.greenBg, padding: "1px 5px", borderRadius: 3 }}>
                    cushion
                  </span>}
                </span>
              </div>
            </div>
            <div style={{ position: "relative", height: 22, background: "#f1f3f5", borderRadius: 5, overflow: "hidden" }}>
              {/* Budget = full width */}
              <div style={{
                position: "absolute", top: 0, left: 0, height: "100%",
                width: `${Math.min(d.pct, 105)}%`,
                background: d.onPace
                  ? `linear-gradient(90deg, ${C.green}20, ${C.green}50)`
                  : `linear-gradient(90deg, ${C.red}20, ${C.red}50)`,
                borderRadius: 5, transition: "width 0.4s",
              }} />
              <div style={{
                position: "absolute", top: 3, left: 3, height: 16,
                width: `${Math.min(d.pct, 104)}%`,
                background: d.onPace ? C.green : C.red,
                borderRadius: 4, opacity: 0.65, transition: "width 0.4s",
              }} />
              {/* 100% marker */}
              <div style={{
                position: "absolute", top: -2, left: "100%", transform: "translateX(-2px)",
                height: 26, width: 2, background: C.text, borderRadius: 1,
              }} />
              {/* Percentage label inside bar */}
              <div style={{
                position: "absolute", top: 3, left: 8, fontSize: 10, fontWeight: 800,
                color: "#fff", fontFamily: mono, lineHeight: "16px",
              }}>
                {d.pct.toFixed(1)}%
              </div>
            </div>
            <div style={{ display: "flex", justifyContent: "space-between", marginTop: 2 }}>
              <span style={{ fontSize: 9, color: C.muted, fontFamily: mono }}>
                Run Rate: ${d.runRate.toFixed(1)}M
              </span>
              <span style={{ fontSize: 9, color: C.muted, fontFamily: mono }}>
                FY Budget: ${d.fy.toFixed(1)}M
              </span>
            </div>
          </div>
        ))}
      </div>
      <div style={{ height: 6 }} />
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 5 — LOAN FUNDING LUMPINESS
// Monthly comm loan II with rolling avg + budget, showing the
// "it's lumpy but the trajectory is there" story
// ══════════════════════════════════════════════════════════════════
const LoanLumpiness = () => {
  const data = monthly.map((d, i) => {
    // 3-month rolling average of actual
    let rolling = null;
    if (d.isActual && i >= 2) {
      rolling = (monthly[i].commII + monthly[i-1].commII + monthly[i-2].commII) / 3;
    } else if (d.isActual && i === 1) {
      rolling = (monthly[0].commII + monthly[1].commII) / 2;
    } else if (d.isActual && i === 0) {
      rolling = monthly[0].commII;
    }
    return {
      month: d.month,
      isActual: d.isActual,
      actual: d.isActual ? d.commII : null,
      budget: d.commII_bgt,
      rolling3mo: rolling,
    };
  });

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>⑤</span>Comm Loan Interest Income — Lumpiness & Trajectory
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 6 }}>
        Loan fundings are lumpy — the rolling avg tells the real trend vs the budget glide path
      </div>
      <div style={{
        fontSize: 10, fontFamily: mono, color: C.text, padding: "8px 10px",
        background: C.amberBg, borderRadius: 5, marginBottom: 12, lineHeight: 1.5, borderLeft: `3px solid ${C.amber}`,
      }}>
        <strong>Read:</strong> Q1 was soft (pipeline delays), May big funding brought us closer.
        Budget assumes steady growth — reality will be lumpy. Watch the rolling avg vs the budget line.
      </div>
      <div style={{ marginBottom: 8 }}>
        <Dot color={C.actual} label="Monthly Actual" />
        <Dot color={C.budget} label="Monthly Budget" striped />
        <Dot color={C.amber} label="3-Mo Rolling Avg" dashed />
      </div>
      <ResponsiveContainer width="100%" height={260}>
        <ComposedChart data={data}>
          <CartesianGrid strokeDasharray="3 3" stroke="#eee" vertical={false} />
          <XAxis dataKey="month" tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} />
          <YAxis domain={[13, 17.5]} tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} tickFormatter={v => `$${v}M`} />
          <Tooltip content={<Tip />} />
          <ReferenceLine x="Jun" stroke={C.actual} strokeWidth={1} strokeDasharray="4 4" />
          {/* Budget bars — full year, faded for future */}
          <Bar dataKey="budget" name="Budget" radius={[3, 3, 0, 0]} barSize={22}>
            {data.map((d, i) => <Cell key={i} fill={C.budget} opacity={d.isActual ? 0.2 : 0.15} />)}
          </Bar>
          {/* Actual bars — solid, on top */}
          <Bar dataKey="actual" name="Actual" radius={[3, 3, 0, 0]} barSize={22} fill={C.actual}>
            {data.map((d, i) => <Cell key={i} fill={C.actual} opacity={0.8} />)}
          </Bar>
          {/* Rolling average */}
          <Line dataKey="rolling3mo" name="3-Mo Rolling Avg" stroke={C.amber} strokeWidth={2.5}
            strokeDasharray="6 3" dot={{ r: 4, fill: C.amber, strokeWidth: 0 }} connectNulls={false} />
          {/* Budget trend line */}
          <Line dataKey="budget" name="Budget Trend" stroke={C.budget} strokeWidth={1.5} dot={false} />
        </ComposedChart>
      </ResponsiveContainer>
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 6 — DEPOSIT GAP
// Balance shortfall + cost pressure = double whammy visual
// ══════════════════════════════════════════════════════════════════
const DepositGap = () => {
  const data = monthly.map((d) => ({
    month: d.month,
    isActual: d.isActual,
    balActual: d.isActual ? d.depAvgBal : null,
    balBudget: d.depAvgBal_bgt,
    balGap: d.isActual ? d.depAvgBal - d.depAvgBal_bgt : null,
    costActual: d.isActual ? d.depCost : null,
    costBudget: d.depCost_bgt,
  }));

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>⑥</span>Deposits — Balance Gap & Cost Pressure
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 6 }}>
        Running ~$100M below budget on avg balance AND paying more than planned
      </div>
      <div style={{
        fontSize: 10, fontFamily: mono, color: C.text, padding: "8px 10px",
        background: C.redBg, borderRadius: 5, marginBottom: 12, lineHeight: 1.5, borderLeft: `3px solid ${C.red}`,
      }}>
        <strong>Action:</strong> Need deposit gathering push. Balance shortfall compresses NII.
        Higher cost means every dollar costs more than plan. Two levers: volume and rate discipline.
      </div>
      <div style={{ marginBottom: 8 }}>
        <Dot color={C.actual} label="Actual Bal" />
        <Dot color={C.budget} label="Budget Bal" dashed />
        <Dot color={C.red} label="Actual Cost (R)" />
        <Dot color={C.budget} label="Budget Cost (R)" dashed />
      </div>
      <ResponsiveContainer width="100%" height={270}>
        <ComposedChart data={data}>
          <CartesianGrid strokeDasharray="3 3" stroke="#eee" vertical={false} />
          <XAxis dataKey="month" tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} />
          <YAxis domain={[3700, 4300]} tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} tickFormatter={v => `$${(v/1000).toFixed(1)}B`} />
          <YAxis yAxisId="cost" orientation="right" domain={[3.2, 3.6]} tick={{ fill: C.red, fontSize: 11 }} axisLine={false} tickLine={false} tickFormatter={v => `${v}%`} />
          <Tooltip content={<Tip />} />
          <ReferenceLine x="Jun" stroke={C.actual} strokeWidth={1} strokeDasharray="4 4" />
          {/* Balance bars */}
          <Bar dataKey="balActual" name="Actual Bal ($M)" fill={C.actual} radius={[3, 3, 0, 0]} barSize={20} opacity={0.7} />
          <Line dataKey="balBudget" name="Budget Bal" stroke={C.budget} strokeWidth={2} strokeDasharray="6 3" dot={false} />
          {/* Cost lines on right axis */}
          <Line yAxisId="cost" dataKey="costActual" name="Actual Cost" stroke={C.red} strokeWidth={2.5}
            dot={{ r: 4, fill: C.red, strokeWidth: 0 }} connectNulls={false} />
          <Line yAxisId="cost" dataKey="costBudget" name="Budget Cost" stroke={C.budget} strokeWidth={1.5}
            strokeDasharray="4 3" dot={false} />
        </ComposedChart>
      </ResponsiveContainer>
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 7 — NIOI DETAIL — Where fee income is leaking
// ══════════════════════════════════════════════════════════════════
const NIOIDetail = () => {
  const feeLines = [
    { label: "Treasury Mgmt", act: sum(actuals, "tm"), bgt: sum(actuals, "tm_bgt"), fyBgt: sum(monthly, "tm_bgt") },
    { label: "PCARD", act: sum(actuals, "pc"), bgt: sum(actuals, "pc_bgt"), fyBgt: sum(monthly, "pc_bgt") },
    { label: "Merchant", act: sum(actuals, "merch"), bgt: sum(actuals, "merch_bgt"), fyBgt: sum(monthly, "merch_bgt") },
    { label: "Service Charges", act: sum(actuals, "svc"), bgt: sum(actuals, "svc_bgt"), fyBgt: sum(monthly, "svc_bgt") },
    { label: "Other", act: sum(actuals, "oth"), bgt: sum(actuals, "oth_bgt"), fyBgt: sum(monthly, "oth_bgt") },
  ].map(d => ({
    ...d, gap: d.act - d.bgt,
    pctOfTotal: (d.act / sum(actuals, "flNIOI")) * 100,
    gapPct: ((d.act - d.bgt) / d.bgt) * 100,
  }));

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>⑦</span>NIOI Breakdown — Fee Income Line by Line
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 14 }}>
        Which fee lines are pulling weight and which need attention
      </div>
      <div style={{ marginBottom: 10 }}>
        <Dot color={C.actual} label="YTD Actual" />
        <Dot color={C.budget} label="YTD Budget" striped />
      </div>
      <ResponsiveContainer width="100%" height={220}>
        <BarChart data={feeLines} barGap={4} barCategoryGap="22%">
          <CartesianGrid strokeDasharray="3 3" stroke="#eee" vertical={false} />
          <XAxis dataKey="label" tick={{ fill: C.muted, fontSize: 10 }} axisLine={false} tickLine={false} />
          <YAxis tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} tickFormatter={v => `$${v}M`} />
          <Tooltip content={<Tip />} />
          <Bar dataKey="act" name="YTD Actual" fill={C.actual} radius={[4, 4, 0, 0]} barSize={24} opacity={0.8} />
          <Bar dataKey="bgt" name="YTD Budget" fill={C.budget} radius={[4, 4, 0, 0]} barSize={24} opacity={0.3} />
        </BarChart>
      </ResponsiveContainer>
      {/* Gap callouts */}
      <div style={{ display: "flex", flexWrap: "wrap", gap: 6, marginTop: 6, marginBottom: 6 }}>
        {feeLines.map((d, i) => {
          const color = d.gap >= 0 ? C.green : d.gap >= -0.2 ? C.amber : C.red;
          const bg = d.gap >= 0 ? C.greenBg : d.gap >= -0.2 ? C.amberBg : C.redBg;
          return (
            <div key={i} style={{ flex: 1, minWidth: 80, textAlign: "center", padding: "5px 4px", background: bg, borderRadius: 4 }}>
              <div style={{ fontSize: 9, color: C.muted, fontFamily: mono }}>{d.label}</div>
              <div style={{ fontSize: 12, fontWeight: 800, color, fontFamily: font }}>
                {d.gap >= 0 ? "+" : ""}{d.gapPct.toFixed(0)}%
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 8 — REVENUE MIX — NII vs NIOI stacked monthly
// ══════════════════════════════════════════════════════════════════
const RevenueMix = () => (
  <div style={cardStyle}>
    <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
      <span style={{ color: C.actual, marginRight: 6 }}>⑧</span>FL Revenue Build — NII + NIOI Monthly
    </div>
    <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 14 }}>
      Stacked composition each month • Solid = actual, faded = budget • Line = budget total
    </div>
    <div style={{ marginBottom: 8 }}>
      <Dot color={C.actual} label="FL NII" />
      <Dot color={C.purple} label="FL NIOI" />
      <Dot color={C.budget} label="Budget Total" dashed />
    </div>
    <ResponsiveContainer width="100%" height={270}>
      <ComposedChart data={monthly}>
        <CartesianGrid strokeDasharray="3 3" stroke="#eee" vertical={false} />
        <XAxis dataKey="month" tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} />
        <YAxis domain={[0, 12]} tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} tickFormatter={v => `$${v}M`} />
        <Tooltip content={<Tip />} />
        <ReferenceLine x="Jun" stroke={C.actual} strokeWidth={1} strokeDasharray="4 4" />
        <Bar dataKey="flNII" name="FL NII" stackId="rev" fill={C.actual}>
          {monthly.map((d, i) => <Cell key={i} opacity={d.isActual ? 0.85 : 0.25} />)}
        </Bar>
        <Bar dataKey="flNIOI" name="FL NIOI" stackId="rev" fill={C.purple} radius={[3, 3, 0, 0]}>
          {monthly.map((d, i) => <Cell key={i} opacity={d.isActual ? 0.85 : 0.25} />)}
        </Bar>
        <Line dataKey="bgtFLRevenue" name="Budget Total" stroke={C.budget} strokeWidth={2} strokeDasharray="6 3" dot={false} />
      </ComposedChart>
    </ResponsiveContainer>
  </div>
);

// ══════════════════════════════════════════════════════════════════
// CHART 9 — STRATEGIC ACTION SUMMARY
// The "so what" — maps each line to an action signal
// ══════════════════════════════════════════════════════════════════
const StrategicActions = () => {
  const actions = [
    {
      area: "Deposits",
      status: "red",
      gap: "$" + Math.abs(sum(actuals, "depAvgBal") - sum(actuals, "depAvgBal_bgt")).toFixed(0) + "M avg bal below plan",
      impact: "Compresses NII by ~$0.4M YTD",
      action: "Deposit campaign — target operating accounts from new C&I relationships. Rate exception discipline on CDs.",
      lever: "Volume + Cost",
    },
    {
      area: "Treasury Management",
      status: "red",
      gap: "$" + Math.abs(sum(actuals, "tm") - sum(actuals, "tm_bgt")).toFixed(1) + "M below plan YTD",
      impact: "Largest single NIOI gap",
      action: "Accelerate TM onboarding pipeline. Every new commercial relationship should include TM analysis at origination.",
      lever: "Revenue per relationship",
    },
    {
      area: "Commercial Loans",
      status: "amber",
      gap: "$" + Math.abs(sum(actuals, "commII") - sum(actuals, "commII_bgt")).toFixed(1) + "M below plan YTD",
      impact: "Trending better — May/Jun recovered. Q3 pipeline looks strong.",
      action: "Push Q3 fundings. Need $50M+ in new production Jul-Sep to hit glide path. Lean into C&I credits with deposit reciprocity.",
      lever: "Volume (lumpy)",
    },
    {
      area: "PCARD / Merchant",
      status: "amber",
      gap: "Combined ~$0.3M below plan",
      impact: "Smaller dollar but high-margin, sticky revenue",
      action: "Cross-sell on existing commercial relationships. Low effort, high retention.",
      lever: "Penetration rate",
    },
    {
      area: "Consumer Loans",
      status: "green",
      gap: "Ahead of plan +$0.5M YTD",
      impact: "Positive contributor — don't need to push here",
      action: "Maintain. No incremental effort needed — let it ride.",
      lever: "—",
    },
  ];

  const statusColor = (s) => s === "green" ? C.green : s === "amber" ? C.amber : C.red;
  const statusBg = (s) => s === "green" ? C.greenBg : s === "amber" ? C.amberBg : C.redBg;
  const statusLabel = (s) => s === "green" ? "ON TRACK" : s === "amber" ? "WATCH" : "ACTION NEEDED";

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>⑨</span>Strategic Action Map — Where to Push
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 14 }}>
        Synthesizes scorecard into actionable priorities for H2
      </div>
      <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
        {actions.map((a, i) => (
          <div key={i} style={{
            padding: "12px 14px", borderRadius: 6,
            border: `1px solid ${statusColor(a.status)}30`,
            background: statusBg(a.status) + "44",
            borderLeft: `4px solid ${statusColor(a.status)}`,
          }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 }}>
              <span style={{ fontSize: 13, fontWeight: 700, color: C.text, fontFamily: font }}>{a.area}</span>
              <span style={{
                fontSize: 9, fontWeight: 700, fontFamily: mono, color: statusColor(a.status),
                background: statusBg(a.status), padding: "2px 8px", borderRadius: 3,
              }}>{statusLabel(a.status)}</span>
            </div>
            <div style={{ fontSize: 11, color: C.text, fontFamily: mono, marginBottom: 4, lineHeight: 1.5 }}>
              <strong>Gap:</strong> {a.gap} &nbsp;•&nbsp; <strong>Impact:</strong> {a.impact}
            </div>
            <div style={{ fontSize: 11, color: C.text, fontFamily: font, lineHeight: 1.5, fontStyle: "italic" }}>
              → {a.action}
            </div>
            <div style={{ fontSize: 9, color: C.muted, fontFamily: mono, marginTop: 4 }}>
              LEVER: {a.lever}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// ══════════════════════════════════════════════════════════════════
// CHART 10 — H2 BRIDGE
// What needs to happen in the back half to hit plan
// ══════════════════════════════════════════════════════════════════
const H2Bridge = () => {
  const ytdGap = sum(actuals, "flRevenue") - sum(actuals, "bgtFLRevenue");
  const h2Budget = sum(remaining, "bgtFLRevenue");
  const fyBudget = sum(monthly, "bgtFLRevenue");
  const needed = fyBudget - sum(actuals, "flRevenue");

  const bridge = [
    { name: "YTD\nActual", value: sum(actuals, "flRevenue"), invisible: 0, isBase: true },
    { name: "Comm Loan\nGrowth", value: 1.8, invisible: sum(actuals, "flRevenue"), positive: true },
    { name: "Deposit\nRecovery", value: 0.6, invisible: sum(actuals, "flRevenue") + 1.8, positive: true },
    { name: "TM\nRamp", value: 0.8, invisible: sum(actuals, "flRevenue") + 2.4, positive: true },
    { name: "Other\nFees", value: 0.3, invisible: sum(actuals, "flRevenue") + 3.2, positive: true },
    { name: "H2 Budget\nBaseline", value: h2Budget - 3.5, invisible: sum(actuals, "flRevenue") + 3.5, positive: true },
    { name: "FY\nTarget", value: fyBudget, invisible: 0, isBase: true },
  ];

  return (
    <div style={cardStyle}>
      <div style={{ fontSize: 14, fontWeight: 700, color: C.text, fontFamily: font, marginBottom: 4 }}>
        <span style={{ color: C.actual, marginRight: 6 }}>⑩</span>H2 Revenue Bridge — How We Get There
      </div>
      <div style={{ fontSize: 11, color: C.muted, fontFamily: mono, marginBottom: 14 }}>
        From where we are today to the full year target — what each lever needs to contribute
      </div>
      <div style={{ display: "flex", gap: 12, marginBottom: 14, padding: "8px", background: "#f8f9fa", borderRadius: 5 }}>
        <div style={{ flex: 1, textAlign: "center" }}>
          <div style={{ fontSize: 9, color: C.muted, fontFamily: mono, textTransform: "uppercase" }}>YTD Banked</div>
          <div style={{ fontSize: 18, fontWeight: 800, color: C.actual, fontFamily: font }}>${sum(actuals, "flRevenue").toFixed(1)}M</div>
        </div>
        <div style={{ flex: 1, textAlign: "center" }}>
          <div style={{ fontSize: 9, color: C.muted, fontFamily: mono, textTransform: "uppercase" }}>Need H2</div>
          <div style={{ fontSize: 18, fontWeight: 800, color: C.amber, fontFamily: font }}>${needed.toFixed(1)}M</div>
        </div>
        <div style={{ flex: 1, textAlign: "center" }}>
          <div style={{ fontSize: 9, color: C.muted, fontFamily: mono, textTransform: "uppercase" }}>FY Target</div>
          <div style={{ fontSize: 18, fontWeight: 800, color: C.green, fontFamily: font }}>${fyBudget.toFixed(1)}M</div>
        </div>
        <div style={{ flex: 1, textAlign: "center" }}>
          <div style={{ fontSize: 9, color: C.muted, fontFamily: mono, textTransform: "uppercase" }}>YTD Pace Gap</div>
          <div style={{ fontSize: 18, fontWeight: 800, color: ytdGap >= 0 ? C.green : C.red, fontFamily: font }}>
            {ytdGap >= 0 ? "+" : ""}${ytdGap.toFixed(1)}M
          </div>
        </div>
      </div>
      <div style={{ marginBottom: 8 }}>
        <Dot color={C.actual} label="Base" />
        <Dot color={C.green} label="Incremental Lever" />
      </div>
      <ResponsiveContainer width="100%" height={240}>
        <BarChart data={bridge} barCategoryGap="12%">
          <CartesianGrid strokeDasharray="3 3" stroke="#eee" vertical={false} />
          <XAxis dataKey="name" tick={{ fill: C.muted, fontSize: 9, fontFamily: mono }} axisLine={false} tickLine={false} interval={0} />
          <YAxis domain={[0, 110]} tick={{ fill: C.muted, fontSize: 11 }} axisLine={false} tickLine={false} tickFormatter={v => `$${v}M`} />
          <Tooltip content={<Tip />} />
          <Bar dataKey="invisible" stackId="b" fill="transparent" />
          <Bar dataKey="value" name="Amount" stackId="b" radius={[4, 4, 0, 0]}>
            {bridge.map((d, i) => (
              <Cell key={i} fill={d.isBase ? C.actual : C.green} opacity={d.isBase ? 0.8 : 0.65} />
            ))}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
};


// ══════════════════════════════════════════════════════════════════
// MAIN LAYOUT
// ══════════════════════════════════════════════════════════════════
function RPDashboard() {
  const [selected, setSelected] = useState(null);

  const charts = [
    { id: 1, component: <Scorecard />, label: "Scorecard" },
    { id: 2, component: <GapChart />, label: "Gap to Plan" },
    { id: 3, component: <CumulativeRevenue />, label: "Cumulative" },
    { id: 4, component: <RunRateGauges />, label: "Run Rate" },
    { id: 5, component: <LoanLumpiness />, label: "Loan Lumpiness" },
    { id: 6, component: <DepositGap />, label: "Deposit Gap" },
    { id: 7, component: <NIOIDetail />, label: "NIOI Detail" },
    { id: 8, component: <RevenueMix />, label: "Revenue Mix" },
    { id: 9, component: <StrategicActions />, label: "Action Map" },
    { id: 10, component: <H2Bridge />, label: "H2 Bridge" },
  ];

  return (
    <div style={{ background: C.bg, minHeight: "100vh", padding: "24px 20px", fontFamily: font }}>
      <div style={{ maxWidth: 1120, margin: "0 auto" }}>
        {/* Header */}
        <div style={{ marginBottom: 20, paddingBottom: 14, borderBottom: `2px solid ${C.text}` }}>
          <div style={{ display: "flex", alignItems: "center", gap: 10, flexWrap: "wrap" }}>
            <h1 style={{ fontSize: 22, fontWeight: 800, color: C.text, margin: 0 }}>Texas Region — RP Dashboard</h1>
            <span style={{
              fontSize: 10, fontWeight: 700, color: "#fff", background: C.actual,
              padding: "3px 10px", borderRadius: 4, fontFamily: mono,
            }}>
              AS OF JUNE 2026 • 6 ACTUAL + 6 BUDGET
            </span>
          </div>
          <p style={{ color: C.muted, fontSize: 11, margin: "6px 0 0", fontFamily: mono }}>
            Where are we behind? Where do we push? What levers move the number?
          </p>
        </div>

        {/* Nav */}
        <div style={{ display: "flex", flexWrap: "wrap", gap: 5, marginBottom: 16 }}>
          <button onClick={() => { setSelected(null); window.scrollTo({ top: 0, behavior: "smooth" }); }}
            style={{
              background: selected === null ? C.text : "transparent",
              color: selected === null ? "#fff" : C.muted,
              border: `1px solid ${selected === null ? C.text : C.border}`,
              borderRadius: 5, padding: "5px 12px", fontSize: 11, cursor: "pointer",
              fontFamily: mono, fontWeight: 600,
            }}>All</button>
          {charts.map(c => (
            <button key={c.id} onClick={() => { setSelected(c.id); window.scrollTo({ top: 0, behavior: "smooth" }); }}
              style={{
                background: selected === c.id ? C.actual : "transparent",
                color: selected === c.id ? "#fff" : C.muted,
                border: `1px solid ${selected === c.id ? C.actual : C.border}`,
                borderRadius: 5, padding: "5px 12px", fontSize: 11, cursor: "pointer",
                fontFamily: mono, fontWeight: 500,
              }}>
              {c.label}
            </button>
          ))}
        </div>

        {/* Grid */}
        <div style={{
          display: "grid",
          gridTemplateColumns: selected ? "1fr" : "repeat(auto-fit, minmax(500px, 1fr))",
          gap: 14,
        }}>
          {charts.filter(c => selected === null || c.id === selected).map(c => (
            <div key={c.id} style={{ cursor: "pointer" }} onClick={() => setSelected(selected === c.id ? null : c.id)}>
              {c.component}
            </div>
          ))}
        </div>

        <div style={{ textAlign: "center", marginTop: 24, paddingTop: 12, borderTop: `1px solid ${C.border}` }}>
          <p style={{ color: C.muted, fontSize: 10, fontFamily: mono }}>Fabricated data • Strategic dashboard concept • Click to isolate</p>
        </div>
      </div>
    </div>
  );
}


    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<RPDashboard />);
  </script>
</body>
</html>